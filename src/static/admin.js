"use strict";(()=>{var c=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var f=(e,t)=>{let n=e.length===16?`${e}:00.000Z`:e,r=new Date(n);if(Number.isNaN(r.getTime()))throw new Error(`Invalid ${t}: ${e}`);return r.toISOString()};var d=["email","phone","address","special_instructions"];var k="0123456789",E="abcdefgh",W=k+E;var h=e=>{if(e.startsWith("/"))return null;try{return new URL(e).protocol!=="https:"?"URL must use https://":null}catch{return"Invalid URL format"}},A=e=>{let t=Number.parseInt(e,10);return Number.isNaN(t)||t<0?"Price must be 0 or greater":null};var F=e=>{let t=e.split(",").map(n=>n.trim()).filter(n=>n);for(let n of t)if(!d.includes(n))return`Invalid contact field: ${n}`;return null},S=["standard","daily"],D=e=>S.includes(e)?null:"Event Type must be standard or daily",p=[...c.slice(1),c[0]],C=e=>{let t=e.split(",").map(n=>n.trim()).filter(n=>n);if(t.length===0)return"At least one day is required";for(let n of t)if(!p.includes(n))return`Invalid day: ${n}. Use: ${p.join(", ")}`;return null},b=128,q=e=>e.length>b?`Description must be ${b} characters or fewer`:null,T=e=>{try{return f(e,"date"),null}catch{return"Please enter a valid date and time"}},Q=[{name:"name",label:"Event Name",type:"text",required:!0,placeholder:"Village Quiz Night",hint:"Displayed to attendees on the ticket page"},{name:"description",label:"Description (optional)",type:"text",placeholder:"A short description of the event",hint:"Shown on the ticket page. HTML is allowed. Max 128 characters.",validate:q},{name:"date",label:"Event Date (optional)",type:"datetime",hint:"When the event takes place. Times are in UTC.",validate:T},{name:"location",label:"Location (optional)",type:"text",placeholder:"e.g. Village Hall, Main Street",hint:"Where the event takes place. Shown on the ticket page."},{name:"event_type",label:"Event Type",type:"select",hint:"Daily events require attendees to select a specific date when booking",options:[{value:"standard",label:"Standard"},{value:"daily",label:"Daily"}],validate:D},{name:"max_attendees",label:"Max Attendees",type:"number",required:!0,min:1,hint:"For daily events, this limit applies per date"},{name:"max_quantity",label:"Max Tickets Per Purchase",type:"number",required:!0,min:1,hint:"Maximum tickets a customer can buy in one transaction"},{name:"bookable_days",label:"Bookable Days (for daily events)",type:"checkbox-group",hint:"Select which days of the week are available for booking",options:p.map(e=>({value:e,label:e})),validate:C},{name:"minimum_days_before",label:"Minimum Days Notice (for daily events)",type:"number",min:0,hint:"How many days in advance attendees must book (0 = same day)"},{name:"maximum_days_after",label:"Maximum Days Ahead (for daily events)",type:"number",min:0,hint:"How far into the future attendees can book (0 = no limit)"},{name:"fields",label:"Contact Fields",type:"checkbox-group",hint:"Which contact details to collect from attendees",options:[{value:"email",label:"Email"},{value:"phone",label:"Phone Number"},{value:"address",label:"Address"},{value:"special_instructions",label:"Special Instructions"}],validate:F},{name:"unit_price",label:"Ticket Price (in pence/cents, leave empty for free)",type:"number",min:0,placeholder:"e.g. 1000 for 10.00",validate:A},{name:"closes_at",label:"Registration Closes At (optional)",type:"datetime",hint:"Leave blank for no deadline. Times are in UTC.",validate:T},{name:"thank_you_url",label:"Thank You URL (optional)",type:"url",placeholder:"https://example.com/thank-you",hint:"Leave blank to show a simple success message",validate:h},{name:"webhook_url",label:"Webhook URL (optional)",type:"url",placeholder:"https://example.com/webhook",hint:"Receives POST with attendee name, email, and phone on registration",validate:h}];var m=e=>e?e.split(",").map(t=>t.trim()).filter(t=>d.includes(t)):[];var x=e=>{if(e.length===0)return"email";let t=new Set;for(let n of e)for(let r of m(n))t.add(r);return d.filter(n=>t.has(n)).join(",")};var P=["address","special_instructions"],U=14,I=4,L=6,M=e=>{let t=m(e),n=0,r=0;for(let s of t)P.includes(s)?r++:n++;return`${U+n*I+r*L}rem`},_=(e,t)=>{let n=M(t);return`<iframe src="${e}?iframe=true" loading="lazy" style="border: none; width: 100%; height: ${n}">Loading..</iframe>`};for(let e of document.querySelectorAll("[data-select-on-click]"))e.addEventListener("click",()=>e.select());for(let e of document.querySelectorAll("[data-nav-select]"))e.addEventListener("change",()=>{location.href=e.value});var a=document.querySelector("[data-multi-booking-url]");if(a){let e=document.querySelector("[data-multi-booking-embed]"),t=[],n=[],r=a.dataset.domain,s=a.placeholder,v=e.placeholder;for(let l of document.querySelectorAll("[data-multi-booking-slug]"))l.addEventListener("change",()=>{let y=l.dataset.multiBookingSlug,w=l.dataset.fields??"";if(l.checked)t.push(y),n.push(w);else{let i=t.indexOf(y);i!==-1&&(t.splice(i,1),n.splice(i,1))}if(t.length>=2){let i=`https://${r}/ticket/${t.join("+")}`;a.value=i,a.placeholder="",e.value=_(i,x(n)),e.placeholder=""}else a.value="",a.placeholder=s,e.value="",e.placeholder=v})}var u=document.querySelector('input[name="date"]'),g=document.querySelector('input[name="closes_at"]');u&&g&&u.addEventListener("change",()=>{u.value&&!g.value&&(g.value=u.value)});var o=document.getElementById("stripe-test-btn");o&&o.addEventListener("click",async()=>{let e=document.getElementById("stripe-test-result");o.disabled=!0,o.textContent="Testing...",e.style.display="none",e.className="";try{let t=o.closest("form").querySelector('input[name="csrf_token"]').value,r=await(await fetch("/admin/settings/stripe/test",{method:"POST",credentials:"same-origin",headers:{"content-type":"application/x-www-form-urlencoded"},body:`csrf_token=${encodeURIComponent(t)}`})).json(),s=[];r.apiKey.valid?s.push(`API Key: Valid (${r.apiKey.mode} mode)`):s.push(`API Key: Invalid${r.apiKey.error?` - ${r.apiKey.error}`:""}`),r.webhook.configured?(s.push(`Webhook: ${r.webhook.status||"configured"}`),s.push(`URL: ${r.webhook.url}`),r.webhook.enabledEvents&&s.push(`Events: ${r.webhook.enabledEvents.join(", ")}`)):s.push(`Webhook: Not configured${r.webhook.error?` - ${r.webhook.error}`:""}`),e.textContent=s.join(`
`),e.className=r.ok?"success":"error",e.style.display="block",e.style.whiteSpace="pre-wrap"}catch(t){e.textContent=`Connection test failed: ${t.message}`,e.className="error",e.style.display="block"}o.disabled=!1,o.textContent="Test Connection"});})();
